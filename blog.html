<!DOCTYPE html>
<html  >
<head>
  <!-- Site made with Mobirise Website Builder v5.3.5, https://mobirise.com -->
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="generator" content="Mobirise v5.3.5, mobirise.com">
  <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1">
  <link rel="shortcut icon" href="assets/images/ca-logo-252x100.png" type="image/x-icon">
  <meta name="description" content="">
  
  
  <title>Blog</title>
  <link rel="stylesheet" href="assets/tether/tether.min.css">
  <link rel="stylesheet" href="assets/bootstrap/css/bootstrap.min.css">
  <link rel="stylesheet" href="assets/bootstrap/css/bootstrap-grid.min.css">
  <link rel="stylesheet" href="assets/bootstrap/css/bootstrap-reboot.min.css">
  <link rel="stylesheet" href="assets/dropdown/css/style.css">
  <link rel="stylesheet" href="assets/socicon/css/styles.css">
  <link rel="stylesheet" href="assets/theme/css/style.css">
  <link rel="preload" href="https://fonts.googleapis.com/css?family=Jost:100,200,300,400,500,600,700,800,900,100i,200i,300i,400i,500i,600i,700i,800i,900i&display=swap" as="style" onload="this.onload=null;this.rel='stylesheet'">
  <noscript><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Jost:100,200,300,400,500,600,700,800,900,100i,200i,300i,400i,500i,600i,700i,800i,900i&display=swap"></noscript>
  <link rel="preload" as="style" href="assets/mobirise/css/mbr-additional.css"><link rel="stylesheet" href="assets/mobirise/css/mbr-additional.css" type="text/css">
  
  
  
  
</head>
<body>
  
  <section class="menu cid-s48OLK6784" once="menu" id="menu1-y">
    
    <nav class="navbar navbar-dropdown navbar-fixed-top navbar-expand-lg">
        <div class="container">
            <div class="navbar-brand">
                <span class="navbar-logo">
                    <a href="http://commonaspect.com">
                        <img src="assets/images/ca-logo-252x100.png" alt="Mobirise" style="height: 5.7rem;">
                    </a>
                </span>
                
            </div>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation">
                <div class="hamburger">
                    <span></span>
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
            </button>
            <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <ul class="navbar-nav nav-dropdown nav-right" data-app-modern-menu="true"><li class="nav-item"><a class="nav-link link text-warning text-primary display-4" href="index.html#features13-1o">ABOUT US</a></li>
                    <li class="nav-item"><a class="nav-link link text-warning text-primary display-4" href="index.html#features4-m">SERVICES</a></li><li class="nav-item"><a class="nav-link link text-warning text-primary display-4" href="index.html#features8-k">CUSTOMERS</a></li><li class="nav-item"><a class="nav-link link text-warning text-primary display-4" href="index.html#contacts1-r">CONTACT</a></li><li class="nav-item"><a class="nav-link link text-warning text-primary display-4" href="blog.html">BLOG</a></li></ul>
                
                
            </div>
        </div>
    </nav>

</section>

<section class="content4 cid-syRvCZjyYa" id="content4-11">
    
    
    <div class="container">
        <div class="row justify-content-center">
            <div class="title col-md-12 col-lg-10">
                <h3 class="mbr-section-title mbr-fonts-style align-center mb-4 display-2">
                    <strong>Emulating Neo4j Graph DB Nodes and Edges in MongoDB 3.6</strong></h3>
                <h4 class="mbr-section-subtitle align-center mbr-fonts-style mb-4 display-7"><em>By Chris Heino, posted December 14, 2017</em></h4>
                
            </div>
        </div>
    </div>
</section>

<section class="content5 cid-syRwgFMnEy" id="content5-13">
    
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-10">
                
                <h4 class="mbr-section-subtitle mbr-fonts-style mb-4 display-5">
                    Introduction</h4>
                <p class="mbr-text mbr-fonts-style display-7">
                    Multi-modal NoSQL database MongoDB added several useful new features since version 3.3, including the $lookup, $graphlookup, and $facet aggregation stages. In this article, I will explore how well the new $graphlookup feature compares to the graph querying capabilities of a specialized graph database such as Neo4j. In particular, we will explain a technique storing graph vertexes and edges in separate MongoDB collections to allow maximum flexibility for querying based on both vertex and edge properties. At the time of writing, I did not find any concrete examples of this technique online, although the MongoDB slide presentation here makes mention of edge collections. This example is based on my own experimentation. </p>
            </div>
        </div>
    </div>
</section>

<section class="content5 cid-syRwp7N3Ed" id="content5-14">
    
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-10">
                
                <h4 class="mbr-section-subtitle mbr-fonts-style mb-4 display-5">
                    Data Model</h4>
                <p class="mbr-text mbr-fonts-style display-7">
                    For our example scenario, we'll use a standard graph theory problem: a simple product recommendations engine as you might find on a typical e-commerce website. </p>
            </div>
        </div>
    </div>
</section>

<section class="image3 cid-syRwD6yPzm" id="image3-15">
    

    

    <div class="container">
        <div class="row justify-content-center">
            <div class="col-12 col-lg-10">
                <div class="image-wrapper">
                    <img src="assets/images/fig1-1-597x339.png" alt="Mobirise">
                    <p class="mbr-description mbr-fonts-style mt-2 align-center display-4">
                        Figure 1</p>
                </div>
            </div>
        </div>
    </div>
</section>

<section class="content5 cid-syRD8jUI3h" id="content5-16">
    
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-10">
                
                
                <p class="mbr-text mbr-fonts-style display-7">
                    The node data will be stored in two Mongo collections named customer and product, and we will use another collection for the edge data.  </p>
            </div>
        </div>
    </div>
</section>

<section class="content7 cid-syRFRghGIU" id="content7-1a">
    
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-12 col-md-10">
                <blockquote>
                <h5 class="mbr-section-title mbr-fonts-style mb-2 display-7"><strong>Collection: customer</strong></h5>
                <p class="mbr-text mbr-fonts-style display-4">/* 1 */<br>{<br>&nbsp; &nbsp; &nbsp;"_id" : ObjectId("5a0bda87e7a83c9369d6f92a"),<br>&nbsp; &nbsp; &nbsp;"name" : "Customer 1"<br>}<br><br>/* 2 */<br>{<br>&nbsp; &nbsp; &nbsp;"_id" : ObjectId("5a0bda9fe7a83c9369d6f92c"),<br>&nbsp; &nbsp; &nbsp;"name" : "Customer 2"<br>}<br><br>/* 3 */<br>{<br>&nbsp; &nbsp; &nbsp;"_id" : ObjectId("5a0bdab3e7a83c9369d6f932"),<br>&nbsp; &nbsp; &nbsp;"name" : "Customer 3"<br>}<br><br>/* 4 */<br>{<br>&nbsp; &nbsp; &nbsp;"_id" : ObjectId("5a0bdac5e7a83c9369d6f938"),<br>&nbsp; &nbsp; &nbsp;"name" : "Customer 4"<br>}</p></blockquote>
            </div>
        </div>
    </div>
</section>

<section class="content7 cid-syRFr75GTo" id="content7-19">
    
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-12 col-md-10">
                <blockquote>
                <h5 class="mbr-section-title mbr-fonts-style mb-2 display-7"><strong>Collection: product</strong></h5>
                <p class="mbr-text mbr-fonts-style display-4">/* 1 */<br>{<br>&nbsp; &nbsp; &nbsp;"_id" : ObjectId("5a0bd9f8e7a83c9369d6f90c"),<br>&nbsp; &nbsp; &nbsp;"name" : "Product A"<br>}<br><br>/* 2 */<br>{<br>&nbsp; &nbsp; &nbsp;"_id" : ObjectId("5a0bda22e7a83c9369d6f914"),<br>&nbsp; &nbsp; &nbsp;"name" : "Product B"<br>}<br><br>/* 3 */<br>{<br>&nbsp; &nbsp; &nbsp;"_id" : ObjectId("5a0bda3ee7a83c9369d6f91a"),<br>&nbsp; &nbsp; &nbsp;"name" : "Product C"<br>}<br><br>/* 4 */<br>{<br>&nbsp; &nbsp; &nbsp;"_id" : ObjectId("5a0bda68e7a83c9369d6f920"),<br>&nbsp; &nbsp; &nbsp;"name" : "Product D"<br>}<br></p></blockquote>
            </div>
        </div>
    </div>
</section>

<section class="content7 cid-syRGcSfo9o" id="content7-1b">
    
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-12 col-md-10">
                <blockquote>
                <h5 class="mbr-section-title mbr-fonts-style mb-2 display-7"><strong>Collection: edge</strong></h5>
                <p class="mbr-text mbr-fonts-style display-4">/* 1 */<br>{<br>&nbsp; &nbsp; &nbsp;"_id" : ObjectId("5a0be126e7a83c9369d6fb40"),<br>&nbsp; &nbsp; &nbsp;"from" : "Customer 1",<br>&nbsp; &nbsp; &nbsp;"to" : "Product D",<br>&nbsp; &nbsp; &nbsp;"refs" : [<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ObjectId("5a0be13ae7a83c9369d6fb48")<br>&nbsp; &nbsp; &nbsp;],<br>&nbsp; &nbsp; &nbsp;"label" : "viewed"<br>}<br><br>/* 2 */<br>{<br>&nbsp; &nbsp; &nbsp;"_id" : ObjectId("5a0be13ae7a83c9369d6fb48"),<br>&nbsp; &nbsp; &nbsp;"from" : "Customer 1",<br>&nbsp; &nbsp; &nbsp;"to" : "Product A",<br>&nbsp; &nbsp; &nbsp;"refs" : [<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ObjectId("5a0be126e7a83c9369d6fb40"),<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ObjectId("5a0be14de7a83c9369d6fb52")<br>&nbsp; &nbsp; &nbsp;],<br>&nbsp; &nbsp; &nbsp;"label" : "purchased"<br>}<br><br>/* 3 */<br>{<br>&nbsp; &nbsp; &nbsp;"_id" : ObjectId("5a0be14de7a83c9369d6fb52"),<br>&nbsp; &nbsp; &nbsp;"from" : "Customer 2",<br>&nbsp; &nbsp; &nbsp;"to" : "Product A",<br>&nbsp; &nbsp; &nbsp;"refs" : [<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ObjectId("5a0be13ae7a83c9369d6fb48"),<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ObjectId("5a0be15ee7a83c9369d6fb56")<br>&nbsp; &nbsp; &nbsp;],<br>&nbsp; &nbsp; &nbsp;"label" : "purchased"<br>}<br><br>/* 4 */<br>{<br>&nbsp; &nbsp; &nbsp;"_id" : ObjectId("5a0be15ee7a83c9369d6fb56"),<br>&nbsp; &nbsp; &nbsp;"from" : "Customer 2",<br>&nbsp; &nbsp; &nbsp;"to" : "Product B",<br>&nbsp; &nbsp; &nbsp;"refs" : [<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ObjectId("5a0be14de7a83c9369d6fb52"),<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ObjectId("5a0bde97e7a83c9369d6fa60")<br>&nbsp; &nbsp; &nbsp;],<br>&nbsp; &nbsp; &nbsp;"label" : "purchased"<br>}<br><br>/* 5 */<br>{<br>&nbsp; &nbsp; &nbsp;"_id" : ObjectId("5a0be172e7a83c9369d6fb60"),<br>&nbsp; &nbsp; &nbsp;"from" : "Customer 3",<br>&nbsp; &nbsp; &nbsp;"to" : "Product B",<br>&nbsp; &nbsp; &nbsp;"refs" : [<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ObjectId("5a0be15ee7a83c9369d6fb56"),<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ObjectId("5a0be1cae7a83c9369d6fb8e")<br>&nbsp; &nbsp; &nbsp;],<br>&nbsp; &nbsp; &nbsp;"label" : "purchased"<br>}<br><br>/* 6 */<br>{<br>&nbsp; &nbsp; &nbsp;"_id" : ObjectId("5a0be1cae7a83c9369d6fb8e"),<br>&nbsp; &nbsp; &nbsp;"from" : "Customer 3",<br>&nbsp; &nbsp; &nbsp;"to" : "Product C",<br>&nbsp; &nbsp; &nbsp;"refs" : [<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ObjectId("5a0be172e7a83c9369d6fb60")<br>&nbsp; &nbsp; &nbsp;],<br>&nbsp; &nbsp; &nbsp;"label" : "purchased"<br>}<br><br>/* 7 */<br>{<br>&nbsp; &nbsp; &nbsp;"_id" : ObjectId("5a375c8594954dcf94f15794"),<br>&nbsp; &nbsp; &nbsp;"from" : "Customer 4",<br>&nbsp; &nbsp; &nbsp;"to" : "Product B",<br>&nbsp; &nbsp; &nbsp;"refs" : [<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ObjectId("5a0be15ee7a83c9369d6fb56"),<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ObjectId("5a0be172e7a83c9369d6fb60")<br>&nbsp; &nbsp; &nbsp;],<br>&nbsp; &nbsp; &nbsp;"label" : "viewed"<br>}</p></blockquote>
            </div>
        </div>
    </div>
</section>

<section class="content5 cid-syRHTKnf3u" id="content5-1c">
    
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-10">
                
                
                <p class="mbr-text mbr-fonts-style display-7">This creates "Customers also bought" recommendations functionality.<br>1. Start with current product being viewed by customer<br>2. Traverse "purchased" edges to customers and products.<br>3. Select the products along the traversal path.<br><br>This gives us the other products purchased by any customer who purchased the original product, and also products purchased by other customers who purchased those products. These types of "friend of a friend" queries are what graph databases excel at, while a traditional relational database is not ideal for this due to the arbitrary number of SQL joins which would be involved since this has performance implications and also typically requires programmatic SQL generation. The strength of each recommendation returned can be determined by its proximity to the starting product.&nbsp;&nbsp;</p>
            </div>
        </div>
    </div>
</section>

<section class="content5 cid-syRI6LZX4U" id="content5-1d">
    
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-10">
                
                <h4 class="mbr-section-subtitle mbr-fonts-style mb-4 display-5">
                    MongoDB Query</h4>
                <p class="mbr-text mbr-fonts-style display-7">
                    The approach below is inspired by the way graph databases such as Neo4j or OrientDB store nodes (a.k.a. vertexes) and edges as separate objects in the database. For purposes of this example, we will create three collections in MongoDB: products, customers, and edges. The documents in the products collection will represent our e-commerce products and contain their attributes, and our customers will be stored as documents in the customers collection. The edge collection documents will represent the edges or relationships between nodes, including a relationship type, a from_id for the source node ID, a to_id for the target node ID, and any other custom properties you want to include. Note that one advantage of this approach is that we do not need to embed the edges within the nodes, in fact the nodes do not need to contain any relationship data whatsoever. </p>
            </div>
        </div>
    </div>
</section>

<section class="content7 cid-syRIcYkXqV" id="content7-1e">
    
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-12 col-md-10">
                <blockquote>
                
                <p class="mbr-text mbr-fonts-style display-4">Although many of these features where added in MongoDB 3.3, version 3.6 is required for this example since 3.6 introduces the "let" and "pipeline" options we will use on the $lookup stage to fetch the node details from the resulting edges. </p></blockquote>
            </div>
        </div>
    </div>
</section>

<section class="content5 cid-syRILgiuiM" id="content5-1f">
    
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-10">
                
                
                <p class="mbr-text mbr-fonts-style display-7">
                    The example below starts by looking for inbound relationships from the target product (Product B). Both $graphLookup and $lookup are used. To traverse edges and filter by edge properties, use $graphLookup. To fetch node details or filter by node properties, use $lookup. </p>
            </div>
        </div>
    </div>
</section>

<section class="content7 cid-syXrHmH81k" id="content7-1s">
    
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-12 col-md-10">
                <blockquote>
                
                <p class="mbr-text mbr-fonts-style display-4">db.product.aggregate( [<br>&nbsp; &nbsp; &nbsp;{ $match: { "name": "Product B" } },<br>&nbsp; &nbsp; &nbsp;{ $lookup: {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; from: "edge",<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; localField: "name",<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; foreignField: "to",<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; as: "edge_docs"<br>&nbsp; &nbsp; &nbsp;}<br>    },<br>    { $project: {<br>&nbsp; &nbsp; &nbsp;"edge_docs": 1<br>&nbsp; &nbsp; &nbsp;}<br>    },<br>    { $graphLookup: {<br>&nbsp; &nbsp; &nbsp;from: "edge",<br>&nbsp; &nbsp; &nbsp;startWith: "$edge_docs._id",<br>&nbsp; &nbsp; &nbsp;connectFromField: "refs",<br>&nbsp; &nbsp; &nbsp;connectToField: "_id",<br>&nbsp; &nbsp; &nbsp;as: "pathEdges",<br>&nbsp; &nbsp; &nbsp;maxDepth: 2,<br>&nbsp; &nbsp; &nbsp;depthField: 'steps',<br>&nbsp; &nbsp; &nbsp;restrictSearchWithMatch: { "label" : "purchased" }<br>&nbsp; &nbsp; &nbsp;}<br>    },<br>    { $project: { "edges" : "$pathEdges" } },<br>    { $unwind: "$edges" },<br>    { $sort: { 'edges.steps': 1 } },<br>    { $lookup: {<br>&nbsp; &nbsp; &nbsp;from: "customer",<br>&nbsp; &nbsp; &nbsp;let: { from: "$edges.from", steps: "$edges.steps" },<br>&nbsp; &nbsp; &nbsp;pipeline: [<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; { $match:<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{ $expr: { $eq: [ "$name",  "$from" ] } }<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; },<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; { $project: { _id: "$_id", name: "$name", steps: "$steps" } }<br>&nbsp; &nbsp; &nbsp;],<br>&nbsp; &nbsp; &nbsp;as: "customers"<br>&nbsp; &nbsp; &nbsp;}<br>    },<br>    { $unwind: "$customers" },<br>    { $sort: { 'customers.steps': 1 } },<br>    { $lookup: {<br>&nbsp; &nbsp; &nbsp;from: "product",<br>&nbsp; &nbsp; &nbsp;let: { to: "$edges.to", steps: "$edges.steps" },<br>&nbsp; &nbsp; &nbsp;pipeline: [<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; { $match:<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{ $expr: { $eq: [ "$name",  "$to" ] } }<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; },<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; { $project: { _id: "$_id", name: "$name", steps: "$steps" } }<br>&nbsp; &nbsp; &nbsp;],<br>&nbsp; &nbsp; &nbsp;as: "products"<br>&nbsp; &nbsp; &nbsp;}<br>    },<br>    { $unwind: "$products" },<br>    { $sort: { 'products.steps': 1 } },<br>    { $group: { _id: null, edgs: { $push: "$edges" }, cstmrs: { $push: "$customers" }, prdcts: { $push: "$products" } } },<br>    { $project: { _id: 0, edges: "$edgs", customers: "$cstmrs", products: "$prdcts" } }<br>] ).map( function(u) {<br>&nbsp; &nbsp; &nbsp;var customerIds = [], newCustomers = [];<br>&nbsp; &nbsp; &nbsp;for (var i = 0; i &lt; u.customers.length; i++) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; var c = u.customers[i];<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (customerIds.indexOf(c._id.toString()) == -1)<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;newCustomers.push(c);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;customerIds.push(c._id.toString());<br>&nbsp; &nbsp; &nbsp;}<br>&nbsp; &nbsp; &nbsp;var productIds = [], newProducts = [];<br>&nbsp; &nbsp; &nbsp;for (var i = 0; i &lt; u.products.length; i++) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; var p = u.products[i];<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (productIds.indexOf(p._id.toString()) == -1)<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; newProducts.push(p);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; productIds.push(p._id.toString());<br>&nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp;u.customers = newCustomers;<br>&nbsp; &nbsp; &nbsp;u.products = newProducts;<br>&nbsp; &nbsp; &nbsp;return u;<br>} );</p></blockquote>
            </div>
        </div>
    </div>
</section>

<section class="content5 cid-syXtnNbIZL" id="content5-1t">
    
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-10">
                
                
                <p class="mbr-text mbr-fonts-style display-7">The query above performs the following steps in the aggregation pipeline: <br>- Use $match to select the target product node.<br>- Use $lookup to find all outbound edges from target node.<br>- Use $project to get the edge data we want to work with.<br>- Use $graphLookup to traverse the edges having label "purchased", up to 2 levels deep.<br>- Use $project to get an edges array.<br>- Use $unwind to get the documents in the edges array.<br>- Use $sort on the "steps" field to list edges in order of traversal.<br>- Use $lookup to get all customer nodes in the traversal path.<br>- Use $unwind and $sort to sort the customer nodes by order of traversal.<br>- Use $lookup to get all product nodes in the traversal path.<br>- Use $unwind and $sort to sort the product nodes by order of traversal.<br>- Use $group and $project to aggregate the documents from each traversal step into a single document with a list of edges and nodes.<br>- Use a $map function to get distinct customer and product nodes in results.</p>
            </div>
        </div>
    </div>
</section>

<section class="content7 cid-syXu3r3Zeb" id="content7-1u">
    
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-12 col-md-10">
                <blockquote>
                
                <p class="mbr-text mbr-fonts-style display-4">The refs property is necessary to allow bidirectional traversal, similar to "both" in Neo4j Cypher. It contains an array of ObjectIds for all other edges intersecting with the current edge at any node. </p></blockquote>
            </div>
        </div>
    </div>
</section>

<section class="content5 cid-syXuiO0ZJn" id="content5-1w">
    
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-10">
                
                
                <p class="mbr-text mbr-fonts-style display-7">
                    After running the query, we get the following output. This document gives us access to all edges and nodes that resulted from the graph traversal, in the correct sequence of the traversal path. </p>
            </div>
        </div>
    </div>
</section>

<section class="content7 cid-syXuHZJfVc" id="content7-1x">
    
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-12 col-md-10">
                <blockquote>
                
                <p class="mbr-text mbr-fonts-style display-4">/* 1 */<br>[<br>&nbsp; &nbsp; &nbsp;{<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; "edges" : [<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; "_id" : ObjectId("5a0be172e7a83c9369d6fb60"),<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; "from" : "Customer 3",<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; "to" : "Product B",<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; "refs" : [<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ObjectId("5a0be15ee7a83c9369d6fb56"),<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ObjectId("5a0be1cae7a83c9369d6fb8e")<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ],<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; "label" : "purchased",<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; "steps" : NumberLong(0)<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;},<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{&nbsp;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; "_id" : ObjectId("5a0be15ee7a83c9369d6fb56"),<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; "from" : "Customer 2",<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; "to" : "Product B",<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; "refs" : [<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ObjectId("5a0be14de7a83c9369d6fb52"),<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ObjectId("5a0bde97e7a83c9369d6fa60")<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ],<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; "label" : "purchased",<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; "steps" : NumberLong(0)<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;},<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; "_id" : ObjectId("5a0be1cae7a83c9369d6fb8e"),<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; "from" : "Customer 3",<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; "to" : "Product C",<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; "refs" : [<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ObjectId("5a0be172e7a83c9369d6fb60")<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ],<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; "label" : "purchased",<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; "steps" : NumberLong(1)<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;},<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; "_id" : ObjectId("5a0be14de7a83c9369d6fb52"),<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; "from" : "Customer 2",<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; "to" : "Product A",<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; "refs" : [<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ObjectId("5a0be13ae7a83c9369d6fb48"),<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ObjectId("5a0be15ee7a83c9369d6fb56")<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ],<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; "label" : "purchased",<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; "steps" : NumberLong(1)<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;},<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; "_id" : ObjectId("5a0be13ae7a83c9369d6fb48"),<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; "from" : "Customer 1",<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; "to" : "Product A",<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; "refs" : [<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ObjectId("5a0be126e7a83c9369d6fb40"),<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ObjectId("5a0be14de7a83c9369d6fb52")<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ],<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; "label" : "purchased",<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; "steps" : NumberLong(2)<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ],<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; "customers" : [<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; "_id" : ObjectId("5a0bdab3e7a83c9369d6f932"),<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; "name" : "Customer 3",<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; "steps" : NumberLong(0)<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;},<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; "_id" : ObjectId("5a0bda9fe7a83c9369d6f92c"),<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; "name" : "Customer 2",<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; "steps" : NumberLong(0)<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;},<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; "_id" : ObjectId("5a0bda87e7a83c9369d6f92a"),<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; "name" : "Customer 1",<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; "steps" : NumberLong(2)<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ],<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; "products" : [<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; "_id" : ObjectId("5a0bda22e7a83c9369d6f914"),<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; "name" : "Product B",<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; "steps" : NumberLong(0)<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;},<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; "_id" : ObjectId("5a0bda3ee7a83c9369d6f91a"),<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; "name" : "Product C",<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; "steps" : NumberLong(1)<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;},<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; "_id" : ObjectId("5a0bd9f8e7a83c9369d6f90c"),<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; "name" : "Product A",<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; "steps" : NumberLong(1)<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ]<br>&nbsp; &nbsp; &nbsp;}<br>]</p></blockquote>
            </div>
        </div>
    </div>
</section>

<section class="content5 cid-syXxQ74QiU" id="content5-1y">
    
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-10">
                
                <h4 class="mbr-section-subtitle mbr-fonts-style mb-4 display-5">
                    Conclusion</h4>
                <p class="mbr-text mbr-fonts-style display-7">The results of this brief experiment are promising for MongoDB's graph query capabilities. We were able to successfully model a directed property graph including both node and edge properties and then query those properties while traversing the graph. The query syntax is more verbose than Neo4j's Cypher and it remains to be seen how well it handles certain edge cases, but for those already using MongoDB for their application, this may be a feasible alternative to deploying a dedicated graph database. Another advantage is that since the graph queries occur in Mongo's aggregation framework, it's easy to integrate with other Mongo features such as faceted search, whereas Neo4j does not support faceted search out of the box. Thanks for reading.</p>
            </div>
        </div>
    </div>
</section>

<section class="footer3 cid-s48P1Icc8J" once="footers" id="footer3-z">

    

    

    <div class="container">
        <div class="media-container-row align-center mbr-white">
            <div class="row row-links">
                <ul class="foot-menu">
                    
                    
                    
                    
                    
                <li class="foot-menu-item mbr-fonts-style display-7"></li><li class="foot-menu-item mbr-fonts-style display-7"></li><li class="foot-menu-item mbr-fonts-style display-7"></li></ul>
            </div>
            <div class="row social-row">
                <div class="social-list align-right pb-2">
                    
                    
                    
                    
                    
                    
                <div class="soc-item">
                        <a href="https://twitter.com/chrisheino" target="_blank">
                            <span class="mbr-iconfont mbr-iconfont-social socicon-twitter socicon"></span>
                        </a>
                    </div><div class="soc-item">
                        <a href="https://www.facebook.com/commonaspect/" target="_blank">
                            <span class="mbr-iconfont mbr-iconfont-social socicon-facebook socicon"></span>
                        </a>
                    </div><div class="soc-item">
                        <a href="https://www.linkedin.com/in/chris-heino-a5588b3/" target="_blank">
                            <span class="mbr-iconfont mbr-iconfont-social socicon-linkedin socicon"></span>
                        </a>
                    </div></div>
            </div>
            <div class="row row-copirayt">
                <p class="mbr-text mb-0 mbr-fonts-style mbr-white align-center display-7">
                    © Copyright 2021 Common Aspect, LLC. All Rights Reserved.
                </p>
            </div>
        </div>
    </div>
</section><section style="background-color: #fff; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica Neue', Arial, sans-serif; color:#aaa; font-size:12px; padding: 0; align-items: center; display: flex;"><a href="https://mobirise.site/d" style="flex: 1 1; height: 3rem; padding-left: 1rem;"></a><p style="flex: 0 0 auto; margin:0; padding-right:1rem;"><a href="https://mobirise.site/i" style="color:#aaa;">Built with Mobirise</a> web page maker</p></section><script src="assets/web/assets/jquery/jquery.min.js"></script>  <script src="assets/popper/popper.min.js"></script>  <script src="assets/tether/tether.min.js"></script>  <script src="assets/bootstrap/js/bootstrap.min.js"></script>  <script src="assets/smoothscroll/smooth-scroll.js"></script>  <script src="assets/dropdown/js/nav-dropdown.js"></script>  <script src="assets/dropdown/js/navbar-dropdown.js"></script>  <script src="assets/touchswipe/jquery.touch-swipe.min.js"></script>  <script src="assets/theme/js/script.js"></script>  
  
  
</body>
</html>